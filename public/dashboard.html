<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Telegram Bot 管理后台</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css">
  <style>
    .sidebar {
      position: fixed;
      top: 0;
      bottom: 0;
      left: 0;
      z-index: 100;
      padding: 48px 0 0;
      box-shadow: inset -1px 0 0 rgba(0, 0, 0, .1);
    }
    .nav-link {
      font-weight: 500;
      color: #333;
    }
    .nav-link.active {
      color: #0d6efd;
    }
    main {
      padding-top: 48px;
    }
    .tab-content {
      padding: 20px 0;
    }
  </style>
</head>
<body>
  <header class="navbar navbar-dark sticky-top bg-dark flex-md-nowrap p-0 shadow">
    <a class="navbar-brand col-md-3 col-lg-2 me-0 px-3" href="#">Telegram Bot 管理后台</a>
    <button class="navbar-toggler d-md-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="navbar-nav">
      <div class="nav-item text-nowrap">
        <a class="nav-link px-3" href="#" onclick="logout()">退出登录</a>
      </div>
    </div>
  </header>

  <div class="container-fluid">
    <div class="row">
      <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block bg-light sidebar collapse">
        <div class="position-sticky pt-3">
          <ul class="nav flex-column">
            <li class="nav-item">
              <a class="nav-link active" href="#bot-management" data-bs-toggle="tab">
                Bot 管理
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#keyword-reply" data-bs-toggle="tab">
                关键词回复
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#broadcast" data-bs-toggle="tab">
                群发消息
              </a>
            </li>
          </ul>
        </div>
      </nav>

      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4">
        <div class="tab-content">
          <!-- Bot 管理 -->
          <div class="tab-pane active" id="bot-management">
            <h2>Bot 管理</h2>
            <div class="row mb-3">
              <div class="col-md-6">
                <label for="bot-select" class="form-label">选择 Bot</label>
                <select class="form-select" id="bot-select"></select>
              </div>
            </div>
            
            <div id="bot-info" class="card mb-4">
              <div class="card-body">
                <h5 class="card-title">Bot 信息</h5>
                <div id="bot-details"></div>
              </div>
            </div>
            
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addBotModal">添加新 Bot</button>
          </div>
          
          <!-- 关键词回复 -->
          <div class="tab-pane" id="keyword-reply">
            <h2>关键词自动回复</h2>
            <div class="table-responsive mb-4">
              <table class="table table-striped table-hover">
                <thead>
                  <tr>
                    <th>匹配类型</th>
                    <th>关键词</th>
                    <th>回复内容</th>
                    <th>操作</th>
                  </tr>
                </thead>
                <tbody id="keywords-list"></tbody>
              </table>
            </div>
            
            <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addKeywordModal">添加关键词</button>
          </div>
          
          <!-- 群发消息 -->
          <div class="tab-pane" id="broadcast">
            <h2>群发消息</h2>
            <div class="card">
              <div class="card-body">
                <div class="mb-3">
                  <label for="message-content" class="form-label">消息内容/图片说明</label>
                  <textarea class="form-control" id="message-content" rows="4"></textarea>
                </div>
                
                <div class="mb-3">
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="message-type" id="type-text" value="text" checked>
                    <label class="form-check-label" for="type-text">纯文本</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="message-type" id="type-photo" value="photo">
                    <label class="form-check-label" for="type-photo">图片</label>
                  </div>
                  <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="message-type" id="type-file" value="document">
                    <label class="form-check-label" for="type-file">文件</label>
                  </div>
                </div>
                
                <div class="mb-3 d-none" id="file-url-container">
                  <label for="file-url" class="form-label">文件/图片URL</label>
                  <input type="text" class="form-control" id="file-url">
                  <small class="form-text text-muted">输入Telegram文件ID或网络URL</small>
                </div>
                
                <div class="alert alert-danger d-none" id="broadcast-error"></div>
                
                <button id="broadcast-btn" class="btn btn-primary">发送给所有用户</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <!-- 添加Bot模态框 -->
  <div class="modal fade" id="addBotModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">添加新Bot</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="add-bot-form">
            <div class="mb-3">
              <label for="bot-name" class="form-label">Bot名称</label>
              <input type="text" class="form-control" id="bot-name">
            </div>
            <div class="mb-3">
              <label for="bot-token" class="form-label">Bot Token</label>
              <input type="text" class="form-control" id="bot-token">
            </div>
            <div class="mb-3">
              <label for="bot-admins" class="form-label">管理员ID列表 (用逗号分隔)</label>
              <input type="text" class="form-control" id="bot-admins">
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="save-bot-btn">保存</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 添加关键词模态框 -->
  <div class="modal fade" id="addKeywordModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">添加关键词回复</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="add-keyword-form">
            <div class="mb-3">
              <label class="form-label">匹配类型</label>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="keyword-match-type" id="match-equal" value="equal" checked>
                <label class="form-check-label" for="match-equal">完全匹配</label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="keyword-match-type" id="match-contain" value="contain">
                <label class="form-check-label" for="match-contain">包含关键词</label>
              </div>
            </div>
            <div class="mb-3">
              <label for="keyword-text" class="form-label">关键词</label>
              <input type="text" class="form-control" id="keyword-text">
            </div>
            <div class="mb-3">
              <label for="keyword-reply" class="form-label">回复内容</label>
              <textarea class="form-control" id="keyword-reply" rows="3"></textarea>
            </div>
          </form>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">取消</button>
          <button type="button" class="btn btn-primary" id="save-keyword-btn">保存</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="js/main.js"></script>
  <script>
    // 显示/隐藏文件URL输入框
    document.querySelectorAll('input[name="message-type"]').forEach(radio => {
      radio.addEventListener('change', function() {
        const fileUrlContainer = document.getElementById('file-url-container');
        if (this.value === 'text') {
          fileUrlContainer.classList.add('d-none');
        } else {
          fileUrlContainer.classList.remove('d-none');
        }
      });
    });
    
    // 登出功能
    function logout() {
      localStorage.removeItem('adminPass');
      window.location.href = 'index.html';
    }
  </script>
</body>
</html>